<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Warframe Weeklies Checklist</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div id="main">
  <h1>Weeklies</h1>
  <div id="taskList"></div>
  <button id="editBtn">Toggle Edit Menu</button>
  <button id="resetBtn">Reset All</button>

  <div id="editMenu">
    <h3>Edit Theme</h3>
    <div class="color-picker"><label>Page Background</label><input type="color" id="bgPicker"></div>
    <div class="color-picker"><label>Text</label><input type="color" id="textPicker"></div>
    <div class="color-picker"><label>Uncompleted</label><input type="color" id="btnOffPicker"></div>
    <div class="color-picker"><label>Compelted</label><input type="color" id="btnOnPicker"></div>
    <div class="color-picker"><label>Edit Button</label><input type="color" id="editBtnPicker"></div>
    <div class="color-picker"><label>Reset Button</label><input type="color" id="resetBtnPicker"></div>
    <div class="color-picker"><label>Edit Menu Background</label><input type="color" id="editMenuBgPicker"></div>
    <div class="color-picker"><label>Text Size </label><input type="range" id="textSizePicker" min="8" max="48" value="16"> <span id="textSizeValue">16</span> px</div>
    <div class="color-picker"><label>Font</label><select id="fontPicker"></select></div>
  </div>
</div>

<script>
let tasks = [];
let state = [];
let visibility = [];
const presetFonts = ["Arial", "Verdana", "Tahoma", "Georgia", "Courier New", "Times New Roman"];

// Default theme colors
const defaultTheme = {
  '--bg': '#1a1a1a',
  '--fg': '#e6e6e6',
  '--btn-bg': '#333',
  '--btn-active': '#4caf50',
  '--edit-btn': '#444',
  '--reset-btn': '#444',
  '--edit-menu-bg': '#222',
  '--btn-text-size': '16',
  '--font-family': 'Arial'
};

async function loadTasks() {
  const res = await fetch('tasks.json');
  const data = await res.json();
  tasks = data.tasks;

  state = JSON.parse(localStorage.getItem('state')) || tasks.map(() => false);
  visibility = JSON.parse(localStorage.getItem('visibility')) || tasks.map(() => true);

  renderTasks();
}

const taskList = document.getElementById('taskList');
const editMenu = document.getElementById('editMenu');
const editBtn = document.getElementById('editBtn');
const resetBtn = document.getElementById('resetBtn');
const fontPicker = document.getElementById('fontPicker');
const textSizePicker = document.getElementById('textSizePicker');
const textSizeValue = document.getElementById('textSizeValue');
const editMenuBgPicker = document.getElementById('editMenuBgPicker');

presetFonts.forEach(f => {
  const option = document.createElement('option');
  option.value = f;
  option.textContent = f;
  fontPicker.appendChild(option);
});

const colorInputs = {
  bgPicker: '--bg',
  textPicker: '--fg',
  btnOffPicker: '--btn-bg',
  btnOnPicker: '--btn-active',
  editBtnPicker: '--edit-btn',
  resetBtnPicker: '--reset-btn',
  editMenuBgPicker: '--edit-menu-bg',
  textSizePicker: '--btn-text-size',
  fontPicker: '--font-family'
};

// Initialize theme with saved values or defaults
Object.keys(colorInputs).forEach(id => {
  const varName = colorInputs[id];
  let saved = localStorage.getItem(varName);
  if (!saved) saved = defaultTheme[varName];

  if(id === 'textSizePicker') {
    document.documentElement.style.setProperty(varName, saved + 'px');
    textSizePicker.value = saved;
    textSizeValue.textContent = saved;
  } else if(id === 'fontPicker') {
    document.documentElement.style.setProperty(varName, saved);
    fontPicker.value = saved;
  } else {
    document.documentElement.style.setProperty(varName, saved);
    if(id === 'editMenuBgPicker') editMenu.style.background = saved;
  }
});

textSizePicker.addEventListener('input', e => {
  const val = e.target.value;
  document.documentElement.style.setProperty('--btn-text-size', val + 'px');
  textSizeValue.textContent = val;
  localStorage.setItem('--btn-text-size', val);
});

fontPicker.addEventListener('change', e => {
  const val = e.target.value;
  document.documentElement.style.setProperty('--font-family', val);
  localStorage.setItem('--font-family', val);
});

editMenuBgPicker.addEventListener('input', e => {
  const val = e.target.value;
  document.documentElement.style.setProperty('--edit-menu-bg', val);
  editMenu.style.background = val;
  localStorage.setItem('--edit-menu-bg', val);
});

Object.keys(colorInputs).forEach(id => {
  if(!['textSizePicker','fontPicker','editMenuBgPicker'].includes(id)) {
    const el = document.getElementById(id);
    el.addEventListener('input', e => {
      const val = e.target.value;
      document.documentElement.style.setProperty(colorInputs[id], val);
      localStorage.setItem(colorInputs[id], val);
    });
  }
});

function save() {
  localStorage.setItem('state', JSON.stringify(state));
  localStorage.setItem('visibility', JSON.stringify(visibility));
}

function renderTasks() {
  taskList.innerHTML = '';
  const editOpen = editMenu.classList.contains('open');

  tasks.forEach((t, i) => {
    const row = document.createElement('div');
    row.className = 'task-row';

    const btn = document.createElement('button');
    btn.className = 'toggle' + (state[i] ? ' active' : '');
    btn.textContent = t.label || t.name || 'Task';
    btn.style.fontSize = `var(--btn-text-size)`;
    btn.style.fontFamily = `var(--font-family)`;
    btn.onclick = () => {
      state[i] = !state[i];
      save();
      renderTasks();
    };

    if(editOpen && !visibility[i]) btn.style.opacity = '0.3';
    else if(!editOpen && !visibility[i]) row.style.display = 'none';
    else {
      btn.style.opacity = '1';
      row.style.display = 'flex';
    }

    row.appendChild(btn);

    const showHide = document.createElement('button');
    showHide.className = 'showhide';
    showHide.textContent = visibility[i] ? 'Hide' : 'Show';
    showHide.style.display = editOpen ? 'block' : 'none';
    showHide.onclick = () => {
      visibility[i] = !visibility[i];
      save();
      renderTasks();
    };
    row.appendChild(showHide);

    taskList.appendChild(row);
  });
}

editBtn.onclick = () => {
  editMenu.classList.toggle('open');
  renderTasks();
};

resetBtn.onclick = () => {
  state = state.map(() => false);
  save();
  renderTasks();
};

loadTasks();
</script>

</body>
</html>


