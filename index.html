<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Weeklies List</title>
  <style>
    :root{
      --bg: #121826;
      --card-bg: #1a2234;
      --text: #f0f4ff;
      --btn-bg: #0f1624;
      --btn-done-bg: #2a3144;
      --reset-bg: #cf7777;
      --card-radius: 14px;
      --btn-radius: 10px;
      --font-size: 15px;
    }

    body{font-family:sans-serif;background:var(--bg);color:var(--text);margin:0;padding:40px;display:flex;justify-content:center}
    .card{background:var(--card-bg);border-radius:var(--card-radius);padding:24px;width:360px;box-shadow:0 8px 20px rgba(0,0,0,0.4)}
    /* header row: title left, toolbar right */
    .header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;gap:12px}
    h1{margin:0;font-size:20px;color:var(--text)}

    /* toolbar sits inline with h1 */
    .toolbar{display:flex;gap:8px;margin:0}

    /* restore old theme button style (matches previous look) */
    .theme-btn{padding:8px 10px;background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--text);border-radius:8px;cursor:pointer}
    .todo-btn{display:block;width:100%;text-align:center;padding:12px 14px;background:var(--btn-bg);border-radius:var(--btn-radius);margin-bottom:10px;font-size:var(--font-size);color:var(--text);border:none;cursor:pointer}
    .todo-btn.done{opacity:0.5;text-decoration:line-through;background:var(--btn-done-bg)}

    #resetBtn{margin-top:14px;width:100%;padding:12px;border:none;border-radius:var(--btn-radius);background:var(--reset-bg);color:var(--text);font-weight:700;cursor:pointer;font-size:var(--font-size)}

    /* Theme dropdown */
    .theme-panel{position:relative}
    .theme-dropdown{position:absolute;right:0;top:40px;background:var(--card-bg);border-radius:10px;padding:12px;box-shadow:0 6px 18px rgba(0,0,0,0.4);min-width:260px;z-index:10}
    .theme-row{display:flex;align-items:center;justify-content:space-between;padding:6px 0}
    .theme-row label{font-size:13px;color:var(--text);margin-right:8px}
    .theme-row input[type="color"]{width:46px;height:30px;border:0;padding:0;background:transparent}
    .theme-row input[type="range"]{width:140px}
    .theme-actions{display:flex;gap:8px;margin-top:8px}
    .small-btn{padding:8px;border-radius:8px;border:none;cursor:pointer}
    .small-btn.save{background:#2a8f7f;color:#fff}
    .small-btn.reset{background:#cf7777;color:#fff}
  </style>
</head>
<body>
  <div class="card">
    <div class="header">
      <h1>Weaklies</h1>
      <div class="toolbar" aria-label="theme toolbar">
        <div class="theme-panel">
          <button id="themeToggle" class="theme-btn">Theme â–¾</button>
          <div id="themeDropdown" class="theme-dropdown" style="display:none">
            <div class="theme-row">
              <label>Background</label>
              <input id="bgColor" type="color" value="#121826">
            </div>
            <div class="theme-row">
              <label>Card</label>
              <input id="cardColor" type="color" value="#1a2234">
            </div>
            <div class="theme-row">
              <label>Text</label>
              <input id="textColor" type="color" value="#f0f4ff">
            </div>
            <div class="theme-row">
              <label>Button</label>
              <input id="btnColor" type="color" value="#0f1624">
            </div>
            <div class="theme-row">
              <label>Done</label>
              <input id="doneColor" type="color" value="#2a3144">
            </div>
            <div class="theme-row">
              <label>Reset</label>
              <input id="resetColor" type="color" value="#cf7777">
            </div>
            <div class="theme-row">
              <label>Font size</label>
              <input id="fontSize" type="range" min="12" max="20" value="15">
            </div>
            <div class="theme-actions">
              <button id="saveTheme" class="small-btn save">Save</button>
              <button id="resetTheme" class="small-btn reset">Reset</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="list">
      <button class="todo-btn">Acrithis Shop</button>
      <button class="todo-btn">Teshin SP Honours</button>
      <button class="todo-btn">Iron Wake</button>
      <button class="todo-btn">Bird 3</button>
      <button class="todo-btn">Yonta</button>
      <br><br><br>
      <button class="todo-btn">Archon Hunt</button>
      <button class="todo-btn">Ayatan Hunt</button>
      <button class="todo-btn">EDA / ETA</button>
      <button class="todo-btn">Nightwave</button>
      <button class="todo-btn">1999 Calendar</button>
      <button class="todo-btn">Circuit</button>
    </div>

    <button id="resetBtn">Reset</button>
  </div>

  <script>
    const STORAGE_KEY = 'simple_todo_state_v2_btn';
    const THEME_KEY = 'simple_todo_theme_v1';
    const todos = document.querySelectorAll('.todo-btn');

    function save(){
      const state = Array.from(todos).map(t => t.classList.contains('done'));
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    function load(){
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return;
      try{
        const state = JSON.parse(raw);
        todos.forEach((t,i)=>{
          if(state[i]) t.classList.add('done');
        });
      }catch{}
    }

    todos.forEach(t => {
      t.addEventListener('click', ()=>{
        t.classList.toggle('done');
        save();
      });
    });

    document.getElementById('resetBtn').onclick = ()=>{
      todos.forEach(t=>t.classList.remove('done'));
      save();
    };

    load();

    // Theme controls
    const themeToggle = document.getElementById('themeToggle');
    const themeDropdown = document.getElementById('themeDropdown');
    const inputs = {
      bgColor: document.getElementById('bgColor'),
      cardColor: document.getElementById('cardColor'),
      textColor: document.getElementById('textColor'),
      btnColor: document.getElementById('btnColor'),
      doneColor: document.getElementById('doneColor'),
      resetColor: document.getElementById('resetColor'),
      fontSize: document.getElementById('fontSize'),
    };

    const defaults = {
      '--bg':'#121826',
      '--card-bg':'#1a2234',
      '--text':'#f0f4ff',
      '--btn-bg':'#0f1624',
      '--btn-done-bg':'#2a3144',
      '--reset-bg':'#cf7777',
      '--font-size':'15px'
    };

    function applyTheme(theme){
      const root = document.documentElement;
      Object.keys(theme).forEach(k=>{
        root.style.setProperty(k, theme[k]);
      });
      // update color inputs without triggering events
      if(theme['--bg']) inputs.bgColor.value = rgbToHex(getComputedStyle(document.documentElement).getPropertyValue('--bg') || theme['--bg']);
      if(theme['--card-bg']) inputs.cardColor.value = rgbToHex(getComputedStyle(document.documentElement).getPropertyValue('--card-bg') || theme['--card-bg']);
      if(theme['--text']) inputs.textColor.value = rgbToHex(getComputedStyle(document.documentElement).getPropertyValue('--text') || theme['--text']);
      if(theme['--btn-bg']) inputs.btnColor.value = rgbToHex(getComputedStyle(document.documentElement).getPropertyValue('--btn-bg') || theme['--btn-bg']);
      if(theme['--btn-done-bg']) inputs.doneColor.value = rgbToHex(getComputedStyle(document.documentElement).getPropertyValue('--btn-done-bg') || theme['--btn-done-bg']);
      if(theme['--reset-bg']) inputs.resetColor.value = rgbToHex(getComputedStyle(document.documentElement).getPropertyValue('--reset-bg') || theme['--reset-bg']);
      if(theme['--font-size']) inputs.fontSize.value = parseInt(theme['--font-size']);
    }

    function saveTheme(theme){
      localStorage.setItem(THEME_KEY, JSON.stringify(theme));
    }

    function loadTheme(){
      const raw = localStorage.getItem(THEME_KEY);
      if(!raw) {
        applyTheme(defaults);
        return;
      }
      try{
        const theme = JSON.parse(raw);
        applyTheme(theme);
      }catch{
        applyTheme(defaults);
      }
    }

    function rgbToHex(value){
      // value may already be a hex
      value = value.trim();
      if(value[0]==='#') return value;
      // handle rgb(a)
      const m = value.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/i);
      if(!m) return value;
      const r = parseInt(m[1]), g = parseInt(m[2]), b = parseInt(m[3]);
      return '#'+[r,g,b].map(x=>x.toString(16).padStart(2,'0')).join('');
    }

    // Toggle dropdown
    themeToggle.addEventListener('click', ()=> {
      themeDropdown.style.display = themeDropdown.style.display === 'none' ? 'block' : 'none';
    });

    // Close when clicking outside
    document.addEventListener('click', (e)=>{
      if(!themeDropdown.contains(e.target) && e.target !== themeToggle){
        themeDropdown.style.display = 'none';
      }
    });

    // Persist current computed theme into an inline style so saved file contains the theme
    function getComputedTheme(){
      const root = getComputedStyle(document.documentElement);
      return {
        '--bg': root.getPropertyValue('--bg').trim() || defaults['--bg'],
        '--card-bg': root.getPropertyValue('--card-bg').trim() || defaults['--card-bg'],
        '--text': root.getPropertyValue('--text').trim() || defaults['--text'],
        '--btn-bg': root.getPropertyValue('--btn-bg').trim() || defaults['--btn-bg'],
        '--btn-done-bg': root.getPropertyValue('--btn-done-bg').trim() || defaults['--btn-done-bg'],
        '--reset-bg': root.getPropertyValue('--reset-bg').trim() || defaults['--reset-bg'],
        '--font-size': root.getPropertyValue('--font-size').trim() || defaults['--font-size'],
      };
    }

    function injectPersistedStyle(theme){
      let el = document.getElementById('persistedTheme');
      const css = ':root{' + Object.entries(theme).map(([k,v])=>`${k}:${v};`).join('') + '}';
      if(!el){
        el = document.createElement('style');
        el.id = 'persistedTheme';
        document.head.appendChild(el);
      }
      el.textContent = css;
    }

    // Debounce helper to avoid excessive writes
    function debounce(fn, wait){
      let t;
      return (...args)=>{
        clearTimeout(t);
        t = setTimeout(()=>fn(...args), wait);
      };
    }

    // Build theme object from current inputs
    function themeFromInputs(){
      return {
        '--bg': inputs.bgColor.value,
        '--card-bg': inputs.cardColor.value,
        '--text': inputs.textColor.value,
        '--btn-bg': inputs.btnColor.value,
        '--btn-done-bg': inputs.doneColor.value,
        '--reset-bg': inputs.resetColor.value,
        '--font-size': inputs.fontSize.value + 'px'
      };
    }

    // Auto-save (to localStorage) and inject persisted style on every change (debounced)
    const autoSave = debounce(()=>{
      const theme = themeFromInputs();
      // save to localStorage (this is what makes changes persist after refresh)
      saveTheme(theme);
      // also inject inline style so if user saves the file later it contains the theme
      injectPersistedStyle(theme);
    }, 300);

    // Live updates + auto-save
    Object.entries(inputs).forEach(([key, el])=>{
      el.addEventListener('input', ()=>{
        const root = document.documentElement;
        switch(key){
          case 'bgColor': root.style.setProperty('--bg', el.value); break;
          case 'cardColor': root.style.setProperty('--card-bg', el.value); break;
          case 'textColor': root.style.setProperty('--text', el.value); break;
          case 'btnColor': root.style.setProperty('--btn-bg', el.value); break;
          case 'doneColor': root.style.setProperty('--btn-done-bg', el.value); break;
          case 'resetColor': root.style.setProperty('--reset-bg', el.value); break;
          case 'fontSize': root.style.setProperty('--font-size', el.value + 'px'); break;
        }
        // persist immediately (debounced)
        autoSave();
      });
    });

    // Save and reset theme buttons (Save still writes to localStorage; kept for manual save if needed)
    document.getElementById('saveTheme').addEventListener('click', ()=>{
      const theme = themeFromInputs();
      saveTheme(theme);
      injectPersistedStyle(theme);
      themeDropdown.style.display = 'none';
    });

    document.getElementById('resetTheme').addEventListener('click', ()=>{
      applyTheme(defaults);
      saveTheme(defaults);
      injectPersistedStyle(defaults);
    });

    // initialize theme
    loadTheme();
    // ensure inline style reflects loaded theme so refresh + "save file" actions include it
    injectPersistedStyle(getComputedTheme());
  </script>
</body>
</html>
